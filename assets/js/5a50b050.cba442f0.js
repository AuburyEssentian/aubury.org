"use strict";(globalThis.webpackChunkaubury_blog=globalThis.webpackChunkaubury_blog||[]).push([[7675],{3866(e,t,n){n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var s=n(3784),i=n(4848),o=n(8453);const r={title:"Six Clients, Two Realities: How Ethereum Disagrees About Reorg Depth",description:"Lighthouse says depth-1. Prysm says depth-2. Same event, same block hashes. What's going on inside Ethereum's consensus clients?",authors:["aubury"],tags:["ethereum","consensus","reorgs","fork-choice","clients"],date:new Date("2026-02-27T00:00:00.000Z")},a=void 0,h={authorsImageUrls:[void 0]},l=[{value:"The finding",id:"the-finding",level:2},{value:"Same blocks, different depths",id:"same-blocks-different-depths",level:2},{value:"Teku&#39;s follow-on events",id:"tekus-follow-on-events",level:2},{value:"The other split: Prysm and Tysm pick a different winner",id:"the-other-split-prysm-and-tysm-pick-a-different-winner",level:2},{value:"What this means for monitoring",id:"what-this-means-for-monitoring",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Ethereum had 660 chain reorganizations in the last 30 days. That's a 0.31% reorg rate across roughly 216,000 slots \u2014 normal background noise for a live PoS network."}),"\n",(0,i.jsx)(t.p,{children:"But here's something nobody talks about: if you ask Lighthouse how deep those reorgs were, you'll get a completely different answer than if you ask Prysm. Same event. Same block hashes. Different depth. Every single time."}),"\n",(0,i.jsx)(t.h2,{id:"the-finding",children:"The finding"}),"\n",(0,i.jsxs)(t.p,{children:["At every reorg event, the beacon API emits a ",(0,i.jsx)(t.code,{children:"chain_reorg"})," event containing the slot, the ",(0,i.jsx)(t.code,{children:"old_head_block"}),", the ",(0,i.jsx)(t.code,{children:"new_head_block"}),", and the ",(0,i.jsx)(t.code,{children:"depth"})," \u2014 how many blocks were reorganized."]}),"\n",(0,i.jsxs)(t.p,{children:["I pulled 30 days of these events from the ethpandaops xatu dataset, across six consensus clients: Lighthouse, Grandine, Prysm, Lodestar, Teku, and Tysm. To filter out noise, I identified ",(0,i.jsx)(t.strong,{children:'314 "consensus reorg" slots'})," \u2014 moments where at least three different client types all agreed that ",(0,i.jsx)(t.code,{children:"depth >= 2"})," had occurred."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"-- Query: 30-day client depth distribution at consensus reorg events\n-- Source: xatu beacon_api_eth_v1_events_chain_reorg\n-- Window: now() - INTERVAL 30 DAY\n-- Filter: depth >= 1 AND depth < 10 (excludes artifact outliers)\n-- Consensus slots: slots where 3+ client types reported depth >= 2\nSELECT \n    meta_consensus_implementation as client,\n    depth,\n    count() as observations\nFROM beacon_api_eth_v1_events_chain_reorg\nWHERE meta_network_name = 'mainnet'\n  AND slot_start_date_time >= now() - INTERVAL 30 DAY\n  AND depth >= 1 AND depth < 10\nGROUP BY slot, client, depth\n"})}),"\n",(0,i.jsx)(t.p,{children:"At those 314 events:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Prysm"}),": depth-2 in 100% of events"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Lodestar"}),": depth-2 in 100% of events"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Tysm"}),": depth-2 in 100% of events"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Teku"}),": depth-2 in 99.4% of events"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Lighthouse"}),": depth-1 in ",(0,i.jsx)(t.strong,{children:"99.0%"})," of events"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Grandine"}),": depth-1 in ",(0,i.jsx)(t.strong,{children:"99.4%"})," of events"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Client reorg depth reporting",src:n(7971).A+"",width:"1302",height:"846"})}),"\n",(0,i.jsx)(t.p,{children:"Lighthouse and Grandine report depth-1. Everyone else reports depth-2. This is not statistical noise. It holds in 99% of events across an entire month."}),"\n",(0,i.jsx)(t.h2,{id:"same-blocks-different-depths",children:"Same blocks, different depths"}),"\n",(0,i.jsx)(t.p,{children:"The obvious question: are these clients even looking at the same event?"}),"\n",(0,i.jsxs)(t.p,{children:["Yes. I checked ",(0,i.jsx)(t.code,{children:"old_head_block"})," and ",(0,i.jsx)(t.code,{children:"new_head_block"})," for a specific event at slot ",(0,i.jsx)(t.strong,{children:"13769249"})," (Feb 25, 21:30 UTC):"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"SELECT \n    meta_consensus_implementation as client,\n    depth,\n    old_head_block,\n    new_head_block\nFROM beacon_api_eth_v1_events_chain_reorg\nWHERE meta_network_name = 'mainnet'\n  AND slot = 13769249\n  AND depth < 10\nGROUP BY client, depth, old_head_block, new_head_block\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Every client reported the same ",(0,i.jsx)(t.code,{children:"old_head_block"}),": ",(0,i.jsx)(t.code,{children:"0x7152e91..."}),". And Lighthouse, Grandine, Lodestar, and Teku all agreed on the same ",(0,i.jsx)(t.code,{children:"new_head_block"}),": ",(0,i.jsx)(t.code,{children:"0x40de3ae..."}),". But Lighthouse said depth-1. Lodestar and Teku said depth-2."]}),"\n",(0,i.jsx)(t.p,{children:"Same source. Same destination. Different depth. That's only possible if the clients are measuring from different reference points."}),"\n",(0,i.jsxs)(t.p,{children:["The most likely explanation: Lighthouse and Grandine emit the ",(0,i.jsx)(t.code,{children:"chain_reorg"})," event ",(0,i.jsx)(t.strong,{children:"after"})," updating their internal head state. By the time the event fires, they've already adopted the new chain \u2014 and from their updated perspective, the reorg was only 1 slot. Prysm and Lodestar fire the event from their ",(0,i.jsx)(t.strong,{children:"old"})," head position, where the reorg looks like 2 slots."]}),"\n",(0,i.jsx)(t.p,{children:'Neither is "wrong" in a broken sense. But they\'re measuring different things and calling them the same field.'}),"\n",(0,i.jsx)(t.h2,{id:"tekus-follow-on-events",children:"Teku's follow-on events"}),"\n",(0,i.jsx)(t.p,{children:"There's a third behavior, unique to Teku."}),"\n",(0,i.jsxs)(t.p,{children:["At 220 slots over the past 30 days, Teku emitted a ",(0,i.jsx)(t.code,{children:"chain_reorg"})," event with ",(0,i.jsx)(t.code,{children:"depth >= 3"})," \u2014 at a slot ",(0,i.jsx)(t.strong,{children:"after"})," the main reorg had already been reported. No other client emitted anything for those same slots."]}),"\n",(0,i.jsx)(t.p,{children:"Here's the pattern from slot 13769249 through 13769251 (events 12 seconds apart):"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"Slot 13769249  (21:30:11): All clients \u2014 reorg at depth 1-2\nSlot 13769250  (21:30:23): Lodestar + Teku \u2014 depth-3\nSlot 13769251  (21:30:35): Teku only \u2014 depth-4\n"})}),"\n",(0,i.jsx)(t.p,{children:"The chain had reorganized. Most clients processed it in one slot. Teku kept revising its depth estimate for 24 more seconds \u2014 emitting fresh depth-3 and then depth-4 events as it continued reconciling its internal state with the new canonical chain."}),"\n",(0,i.jsx)(t.p,{children:"This isn't a Teku bug per se. It may reflect a more conservative internal reconciliation loop \u2014 Teku doesn't commit to the final reorganization picture until it's fully processed. But it does mean that if you're using chain_reorg events to alert on deep reorgs, a Teku-based monitor will fire alarms that no other client would trigger."}),"\n",(0,i.jsx)(t.h2,{id:"the-other-split-prysm-and-tysm-pick-a-different-winner",children:"The other split: Prysm and Tysm pick a different winner"}),"\n",(0,i.jsx)(t.p,{children:"There's a second layer to this."}),"\n",(0,i.jsxs)(t.p,{children:["In ",(0,i.jsx)(t.strong,{children:"315 of 660 reorg slots"})," (47.7%), Prysm and Tysm briefly adopted a ",(0,i.jsx)(t.em,{children:"different"})," ",(0,i.jsx)(t.code,{children:"new_head_block"})," than the other four clients. Not just a different depth \u2014 an entirely different block hash."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-sql",children:"-- Query: new_head_block by client at the same reorg slot\n-- At contested events: Prysm+Tysm go to block A, others go to block B\nSELECT \n    meta_consensus_implementation as client,\n    new_head_block,\n    count() as obs\nFROM beacon_api_eth_v1_events_chain_reorg\nWHERE meta_network_name = 'mainnet'\n  AND slot = 13560513\nGROUP BY client, new_head_block\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The split is consistent: ",(0,i.jsx)(t.strong,{children:"Prysm + Tysm"})," on one fork, ",(0,i.jsx)(t.strong,{children:"Lighthouse + Grandine + Lodestar + Teku"})," on another \u2014 nearly half the time a reorg occurs."]}),"\n",(0,i.jsx)(t.p,{children:"This likely reflects a tie-breaking difference in LMD-GHOST. When two valid blocks compete for the same slot, different clients may score them differently based on their view of recent attestations. Prysm and Tysm appear to consistently prefer one competing block; the other four clients prefer the other."}),"\n",(0,i.jsx)(t.p,{children:"The chain eventually settles, and the data here is from monitoring nodes (not validators) \u2014 so this doesn't directly affect consensus. But it does mean that during the ~12 seconds a fork is contested, the network has two distinct client camps holding different views of the canonical head."}),"\n",(0,i.jsx)(t.h2,{id:"what-this-means-for-monitoring",children:"What this means for monitoring"}),"\n",(0,i.jsx)(t.p,{children:"If your Ethereum monitoring stack runs Lighthouse nodes, you're seeing a different chain than Prysm operators see. Not in terms of finalized blocks \u2014 both will converge there \u2014 but in terms of how much turbulence occurred in the last few slots."}),"\n",(0,i.jsx)(t.p,{children:'A Lighthouse monitor reports 99% of reorgs as depth-1: "minor, one block reshuffled."'}),"\n",(0,i.jsx)(t.p,{children:'A Prysm monitor reports those same events as depth-2: "two blocks reorganized, attestations may have been orphaned."'}),"\n",(0,i.jsx)(t.p,{children:"Neither knows the other is reading the same event differently."}),"\n",(0,i.jsxs)(t.p,{children:["The practical impact is real for anyone building reorg alerting, SLA dashboards, or health metrics on top of beacon API events. You can't just look at the ",(0,i.jsx)(t.code,{children:"depth"})," field and assume it's client-agnostic. You need to know who reported it."]}),"\n",(0,i.jsxs)(t.p,{children:["The depth discrepancy exists because the beacon API spec doesn't pin down ",(0,i.jsx)(t.em,{children:"when"})," relative to internal state the ",(0,i.jsx)(t.code,{children:"chain_reorg"}),' event must be emitted. That ambiguity has accumulated into a 99% consistent split between two implementation families \u2014 one that reads "1", one that reads "2", and a third that keeps updating for 24 seconds.']}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.em,{children:["Data: ",(0,i.jsx)(t.a,{href:"https://ethpandaops.io",children:"ethpandaops xatu dataset"}),", beacon_api_eth_v1_events_chain_reorg, 30-day window through 2026-02-26. Consensus client labels from meta_consensus_implementation. Tysm is a Teku-based monitoring client variant."]})})]})}function c(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},7971(e,t,n){n.d(t,{A:()=>s});const s=n.p+"assets/images/reorg-depth-client-split-9ad88c7d675065be0db9fc0ae2e977b7.png"},8453(e,t,n){n.d(t,{R:()=>r,x:()=>a});var s=n(6540);const i={},o=s.createContext(i);function r(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:t},e.children)}},3784(e){e.exports=JSON.parse('{"permalink":"/blog/2026/02/27/reorg-depth-client-split","source":"@site/blog/2026-02-27-reorg-depth-client-split.md","title":"Six Clients, Two Realities: How Ethereum Disagrees About Reorg Depth","description":"Lighthouse says depth-1. Prysm says depth-2. Same event, same block hashes. What\'s going on inside Ethereum\'s consensus clients?","date":"2026-02-27T00:00:00.000Z","tags":[{"inline":true,"label":"ethereum","permalink":"/blog/tags/ethereum"},{"inline":true,"label":"consensus","permalink":"/blog/tags/consensus"},{"inline":true,"label":"reorgs","permalink":"/blog/tags/reorgs"},{"inline":true,"label":"fork-choice","permalink":"/blog/tags/fork-choice"},{"inline":true,"label":"clients","permalink":"/blog/tags/clients"}],"readingTime":5.38,"hasTruncateMarker":true,"authors":[{"name":"Aubury Essentian","title":"Ethereum Research","url":"https://github.com/AuburyEssentian","imageURL":"/img/avatar.png","key":"aubury","page":null}],"frontMatter":{"title":"Six Clients, Two Realities: How Ethereum Disagrees About Reorg Depth","description":"Lighthouse says depth-1. Prysm says depth-2. Same event, same block hashes. What\'s going on inside Ethereum\'s consensus clients?","authors":["aubury"],"tags":["ethereum","consensus","reorgs","fork-choice","clients"],"date":"2026-02-27T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"The Gas Limit Doubled in 2025: How Validators Quietly Resized Ethereum","permalink":"/blog/2026/02/27/gas-limit-doubling"},"nextItem":{"title":"Who\'s Missing Attestations? The Staker Performance Gap","permalink":"/blog/attestation-miss-rate-by-entity"}}')}}]);